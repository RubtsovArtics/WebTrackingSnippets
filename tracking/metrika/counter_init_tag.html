<script type="text/javascript">
    (function (d, w, c) {
    	// Задаем параметр версии Вебвизора - 1 или 2
        w['yandex_metrika_webvisor'] = 2;
        c = (w['yandex_metrika_webvisor'] == 2) ? 'yandex_metrika_callbacks2':'yandex_metrika_callbacks';
        (w[c] = w[c] || []).push(function() {
            try {
                var params = {
                    id: Number({{YM -- Tracker}}),
                    clickmap: true,
                    trackLinks: true,
                    accurateTrackBounce: true,
                    triggerEvent: true,
                    webvisor: true,
                    ecommerce: "dataLayer"
                };
                w['yaCounter' + {{YM -- Tracker}}] = (w['yandex_metrika_webvisor'] == 2) ? new Ya.Metrika2(params):new Ya.Metrika(params);
                w['document'].addEventListener('yacounter' + {{YM -- Tracker}} + 'inited', function() {
                	dataLayer = w.dataLayer || [];
		            dataLayer.push({
		                'event': 'YMReady',
		                'isYMReady': 'true',
		                'ymclid': w['yaCounter' + {{YM -- Tracker}}].getClientID()
		            });
                });
                w.goalSender = function(t,p,b,id) {
                    id = typeof id !== 'undefined' ? id : {{YM -- Tracker}};
                    p = typeof p !== 'undefined' ? p : undefined;
                    b = typeof b !== 'undefined' ? b : undefined;
                    if (typeof w['yaCounter' + id] == 'object') {
                        if (typeof p == 'object' || typeof p == 'function'){
                            if (typeof b == 'function' || typeof b == 'object'){
                                w['yaCounter' + id].reachGoal(t,p,b);
                            } else{
                                w['yaCounter' + id].reachGoal(t,p);
                            }
                        } else {
                            if (typeof b == 'function' || typeof b == 'object') {
                                w['yaCounter' + id].reachGoal(t,b);
                            } else {
                                w['yaCounter' + id].reachGoal(t);
                            }
                        }
                    } else {
                        w['document'].addEventListener('yacounter' + id + 'inited', function() {
                        	w.goalSender(t,p,b,id);
                        });
                    }
                };
            } catch(e) { 
                console.log(e)
                dataLayer = w.dataLayer || [];
                dataLayer.push({
                    'event': 'YMFail',
                    'isYMReady': 'false',
                    'failReason': String(e)
                });
            }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = (w['yandex_metrika_webvisor'] == 2) ? "https://mc.yandex.ru/metrika/tag.js":"https://mc.yandex.ru/metrika/watch.js";
        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/{{YM -- Tracker}}" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
